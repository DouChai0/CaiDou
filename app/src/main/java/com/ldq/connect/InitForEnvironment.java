package com.ldq.connect;

import android.content.pm.ApplicationInfo;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.os.Environment;

import com.ldq.Utils.FileUtils;
import com.ldq.Utils.MLogCat;
import com.ldq.connect.ExceptionHelper.CatchInstance;
import com.ldq.connect.MTool.FriendObserve.FriendsObserve;

import java.io.File;
import java.io.IOException;

public class InitForEnvironment {
    public static String a2 = "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000" +
            "000000000000000000000000000000000000000000000000000000000011000000010110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111010101111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001101111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111011111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001101111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110101110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011100111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100" ;
    public static String a3 = "000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000101111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111011111000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100100000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100011100000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000111110000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110011111110000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111110000000000000000000000111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000" +
            "00000000000001111111111111111111111111111111111111111111111110000111111111111111111111111111111111111111111111111101000000000000000000000011111111111111111111111111111111111111111111000000000000000111111111111111111111111111111111111111111110000000000000000000001111111111111111111111111111111110000000000000000000000000000111111111111111111111111111111111111111111000000000000000000000111111111111111111111111111111110000000000000000000000000000000111111111111111111111111111111111111111100000000000000000000011111111111111111111111111111111000000000000000000000000000000111111111111111111111111111111111111111110000000000000000000011111111111111111111111111111100000000000000000000000000000000011111111111111111111111111111111111111111100000000000000000000111111111111111111111111111000000000000000000000000000000000000111001111111111111111111111111111111111111110000000000000000000001111111111111111110000000000000000000000000000000000000000000000000111111111111111111111111111111111111100000000000000000000111111111111111111100000000000000000000000000000000000000000000000001111111111111111111111111111111111110000000000000000000001111111111111111110000000000000000000000000000000000000000000000000001111111111111111111111111111111111100000000000000000000111111111111111110000000000000000000000000000000000000000000000000000000011111111111111111111111111111111000000000000000000000000011111111110000000000000000000000000000000000000000000000000011111111111111" ;

    public static void StartInit()
    {
        InitFolder();
        CatchInstance.StartCatch();

        InitForApiAndCDN();
        MHookEnvironment.mTask.init();
        InitQQVersion();
        FriendsObserve.CreateNotify();
    }
    public static void InitQQVersion()
    {
        try {
            //获取普通apk版本信息
            PackageManager pm = MHookEnvironment.MAppContext.getPackageManager();
            PackageInfo mSelfInfo = pm.getPackageInfo("com.tencent.mobileqq",0);
            String Version_1 = mSelfInfo.versionName;

            //获取QQ小版本信息
            ApplicationInfo sAppInfo = pm.getApplicationInfo("com.tencent.mobileqq",PackageManager.GET_META_DATA);
            String UUID = sAppInfo.metaData.getString("com.tencent.rdm.uuid");

            MHookEnvironment.MVersion = Version_1+"."+UUID.substring(0,UUID.indexOf("_"));
            MHookEnvironment.MVersionInt = Integer.parseInt(UUID.substring(0,UUID.indexOf("_")));
        } catch (Throwable e) {
            MLogCat.Print_Error("GetQQVersion",e);
        }
    }
    public static void InitForApiAndCDN(){
        try{

            String CheckPath = Environment.getExternalStorageDirectory()+"/Android/media/com.tencent.mobileqq/tem_cdn";;
            if(!new File(CheckPath).exists()){
                CheckPath = Environment.getExternalStorageDirectory()+"/Android/data/com.tencent.mobileqq/files/tem_cdn";

            }

            if(new File(CheckPath).exists()){
                MHookEnvironment.ServerRoot_CDN = FileUtils.ReadFileString(CheckPath);
            }else{
                MHookEnvironment.ServerRoot_CDN = "https://cdn.haonb.cc/";
            }
        }catch (Exception e){
            MHookEnvironment.ServerRoot_CDN = "https://cdn.haonb.cc/";
        }

        try{
            String CheckPath = Environment.getExternalStorageDirectory()+"/Android/media/com.tencent.mobileqq/tem_api";
            if(!new File(CheckPath).exists()){
                CheckPath = Environment.getExternalStorageDirectory()+"/Android/data/com.tencent.mobileqq/files/tem_api";

            }

            if(new File(CheckPath).exists()){
                MHookEnvironment.ServerRoot_API = FileUtils.ReadFileString(CheckPath);
            }else{
                MHookEnvironment.ServerRoot_API = "https://api.haonb.cc/";
            }
        }catch (Exception e){
            MHookEnvironment.ServerRoot_API = "https://api.haonb.cc/";
        }


    }
    public static void InitFolder() {
        File ffff =  new File(MHookEnvironment.PublicStorageModulePath + "");
        if(!ffff.exists())ffff.mkdirs();
        ffff =  new File(MHookEnvironment.PublicStorageModulePath + "Log");
        if(!ffff.exists())ffff.mkdirs();
        ffff =  new File(MHookEnvironment.PublicStorageModulePath + "Plugin");
        if(!ffff.exists())ffff.mkdirs();
        ffff =  new File(MHookEnvironment.PublicStorageModulePath + "Cache");
        if(!ffff.exists())ffff.mkdirs();

        File moMedia = new File(MHookEnvironment.PublicStorageModulePath + ".nomedia");
        if(!moMedia.exists()) {
            try {
                moMedia.createNewFile();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
